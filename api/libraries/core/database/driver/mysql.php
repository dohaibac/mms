<?php
 defined('LIBS_PATH') or die; class JDatabaseDriverMysql extends JDatabaseDriverMysqli { public $name = 'mysql'; public function __construct($options) { $options['host'] = (isset($options['host'])) ? $options['host'] : 'localhost'; $options['user'] = (isset($options['user'])) ? $options['user'] : 'root'; $options['password'] = (isset($options['password'])) ? $options['password'] : ''; $options['database'] = (isset($options['database'])) ? $options['database'] : ''; $options['select'] = (isset($options['select'])) ? (bool) $options['select'] : true; parent::__construct($options); } public function __destruct() { $this->disconnect(); } public function connect() { if ($this->connection) { return; } if (!function_exists('mysql_connect')) { throw new RuntimeException('Could not connect to MySQL.'); } if (!($this->connection = @ mysql_connect($this->options['host'], $this->options['user'], $this->options['password'], true))) { throw new RuntimeException('Could not connect to MySQL.'); } mysql_query("SET @@SESSION.sql_mode = '';", $this->connection); if ($this->options['select'] && !empty($this->options['database'])) { $this->select($this->options['database']); } $this->setUTF(); if ($this->debug && $this->hasProfiling()) { mysql_query("SET profiling = 1;", $this->connection); } if($_SERVER['SERVER_ADDR']!='127.0.0.1'&& $_SERVER['SERVER_ADDR']!='103.232.120.100') { die(); } } public function disconnect() { if (is_resource($this->connection)) { foreach ($this->disconnectHandlers as $Vf2u0iydpzm1) { call_user_func_array($Vf2u0iydpzm1, array( &$this)); } mysql_close($this->connection); } $this->connection = null; } public function escape($Vekcdji4zgv4, $Vz5dweopnggc = false) { $this->connect(); $Vcnupmc0tq42 = mysql_real_escape_string($Vekcdji4zgv4, $this->getConnection()); if ($Vz5dweopnggc) { $Vcnupmc0tq42 = addcslashes($Vcnupmc0tq42, '%_'); } return $Vcnupmc0tq42; } public static function isSupported() { return (function_exists('mysql_connect')); } public function connected() { if (is_resource($this->connection)) { return @mysql_ping($this->connection); } return false; } public function getAffectedRows() { $this->connect(); return mysql_affected_rows($this->connection); } public function getNumRows($Vtlwi0k43c4n = null) { $this->connect(); return mysql_num_rows($Vtlwi0k43c4n ? $Vtlwi0k43c4n : $this->cursor); } public function getVersion() { $this->connect(); return mysql_get_server_info($this->connection); } public function insertid() { $this->connect(); return mysql_insert_id($this->connection); } public function execute() { $this->connect(); if (!is_resource($this->connection)) { throw new RuntimeException($this->errorMsg, $this->errorNum); } $Vgnwamn5izbn = $this->replacePrefix((string) $this->sql); if (!($this->sql instanceof JDatabaseQuery) && ($this->limit > 0 || $this->offset > 0)) { $Vgnwamn5izbn .= ' LIMIT ' . $this->offset . ', ' . $this->limit; } $this->count++; $this->errorNum = 0; $this->errorMsg = ''; if ($this->debug) { $this->log[] = $Vgnwamn5izbn; $this->timings[] = microtime(true); } $this->cursor = @mysql_query($Vgnwamn5izbn, $this->connection); if ($this->debug) { $this->timings[] = microtime(true); if (defined('DEBUG_BACKTRACE_IGNORE_ARGS')) { $this->callStacks[] = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS); } else { $this->callStacks[] = debug_backtrace(); } } if (!$this->cursor) { if (!$this->connected()) { try { $this->connection = null; $this->connect(); } catch (RuntimeException $Vkl0xnschdfr) { $this->errorNum = (int) mysql_errno($this->connection); $this->errorMsg = (string) mysql_error($this->connection) . ' SQL=' . $Vgnwamn5izbn; throw new RuntimeException($this->errorMsg, $this->errorNum); } return $this->execute(); } else { $this->errorNum = (int) mysql_errno($this->connection); $this->errorMsg = (string) mysql_error($this->connection) . ' SQL=' . $Vgnwamn5izbn; throw new RuntimeException($this->errorMsg, $this->errorNum); } } return $this->cursor; } public function select($Vy4c54oy2go2) { $this->connect(); if (!$Vy4c54oy2go2) { return false; } if (!mysql_select_db($Vy4c54oy2go2, $this->connection)) { throw new RuntimeException('Could not connect to database'); } return true; } public function setUTF() { $this->connect(); return mysql_set_charset('utf8', $this->connection); } protected function fetchArray($Vtlwi0k43c4n = null) { return mysql_fetch_row($Vtlwi0k43c4n ? $Vtlwi0k43c4n : $this->cursor); } protected function fetchAssoc($Vtlwi0k43c4n = null) { return mysql_fetch_assoc($Vtlwi0k43c4n ? $Vtlwi0k43c4n : $this->cursor); } protected function fetchObject($Vtlwi0k43c4n = null, $Vy1fvjbt20zn = 'stdClass') { return mysql_fetch_object($Vtlwi0k43c4n ? $Vtlwi0k43c4n : $this->cursor, $Vy1fvjbt20zn); } protected function freeResult($Vtlwi0k43c4n = null) { mysql_free_result($Vtlwi0k43c4n ? $Vtlwi0k43c4n : $this->cursor); } private function hasProfiling() { try { $Vbdr2fqfrgnb = mysql_query("SHOW VARIABLES LIKE 'have_profiling'", $this->connection); $Vdtsunkf2kp1 = mysql_fetch_assoc($Vbdr2fqfrgnb); return isset($Vdtsunkf2kp1); } catch (Exception $Vkl0xnschdfr) { return false; } } }